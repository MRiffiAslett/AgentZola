The model should contain the following pattern to trigger the optimization pass `TopkRewriter`:

1. The model should have a `Sort` operation with either one or two operands. If there are two operands, the second operand should be an `Iota` operation or a `Broadcast` of an `Iota` operation.

2. The `Sort` operation should use a comparison function that is NaN-safe. This means that the comparison function should handle NaN values correctly according to the IEEE 754 standard.

3. The `Sort` operation should be used in a specific way that corresponds to a Top-K operation. This means that the sorted values should be sliced to get the top K values, and the slice should start at the beginning of the sorted values and have a stride of 1. The slice should not affect any dimensions other than the sort dimension.

4. The element type of the data to be sorted should be either `F32` or `BF16`.

5. The sort dimension should be either the first or the last dimension.

6. The transformation should be profitable according to a provided profitability check function.

If all these conditions are met, the `Sort` operation is transformed into a custom call to a Top-K operation, which can be more efficient. The transformation also handles cases where the input data is reshaped or transposed before the `Sort` operation, and it reshapes or transposes the output of the Top-K operation back to the original shape if necessary.